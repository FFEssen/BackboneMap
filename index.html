
<!DOCTYPE html>
<html>
<head>
	<title>Freifunk Planung</title>
	<meta charset="utf-8" />
    <link rel="stylesheet" href="leaflet.css" />
	<link rel="stylesheet" href="leaflet.draw.css" />

	<script src="leaflet.js"></script>
	<script src="leaflet.draw.js"></script>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="leaflet.css" />
</head>
<body style="height: 100%; margin: 0;">
	<div id="map" style="position:fixed; width: 100%; height: 100%;"></div>
	<script>

		var map = L.map('map').setView([51.454121, 7.012690], 13);

		var layer = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
          maxZoom: 25
        }).addTo(map);

		//L.marker([51.5, -0.09]).addTo(map).bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

        var drawnItems = new L.FeatureGroup();
		map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
			draw: {
				position: 'topleft',
				polygon: {
					title: 'Haus eintragen',
					allowIntersection: false,
					drawError: {
						color: '#b00b00',
						timeout: 1000
					},
					shapeOptions: {
						color: '#ff0000'
					},
					showArea: false,
				},
                rectangle: false,
				polyline: {
					metric: true
				},
				circle: false,
                marker: {
                    title: 'Knoten eintragen'
                }
			}
		});
		map.addControl(drawControl);

        map.on('draw:created', function (e) {
            var type = e.layerType,
                layer = e.layer;

            if (type === 'marker') {
                // Do marker specific actions
            } else if (type === 'polygon') {
                latlng = e.layer.toGeoJSON().geometry.coordinates[0];
                latlng.pop();
                for (var i=0;i<latlng.length;i++) {
                    tmp = latlng[i][0]
                    latlng[i][0] = Math.round(latlng[i][1]*1000000)/1000000;
                    latlng[i][1] = Math.round(tmp*1000000)/1000000;
                }
                console.log(JSON.stringify(latlng));
            }

            // Do whatever else you need to. (save to db, add to map etc)
            map.addLayer(layer);
        });

		/*
        L.polygon([[51.460852,6.945248],[51.458285,6.957264],[51.449942,6.953487],[51.450905,6.946106]], { weight: 0, fillColor: '#ff0000', fillOpacity: 0.4 }).addTo(map).bindPopup("I am a polygon.");
        */

        L.polygon([[51.465568,6.957446],[51.46551,6.957591],[51.465266,6.957342],[51.465129,6.957623],[51.465254,6.957808],[51.465186,6.957932],[51.464967,6.95761],[51.465032,6.957484],[51.46505,6.957513],[51.465176,6.957253],[51.465147,6.957226],[51.465204,6.957076],[51.465274,6.957143],[51.465291,6.9571],[51.465348,6.957154],[51.465329,6.9572]], {weight: 0, fillColor: '#FF0000', fillOpacity: 0.4}).addTo(map).bindPopup('<strong>Bischof von Ketteler Schule</strong><br><br>Keine Notizen');
L.polygon([[51.465714,6.955309],[51.465788,6.955413],[51.466009,6.955027],[51.46609,6.955142],[51.466161,6.955023],[51.466472,6.955475],[51.466275,6.955832],[51.46634,6.955911],[51.466532,6.955559],[51.466573,6.955622],[51.466653,6.955475],[51.466155,6.954743],[51.466073,6.954888],[51.46614,6.954991],[51.466109,6.95504],[51.465977,6.954853],[51.465851,6.955066]], {weight: 0, fillColor: '#FF0000', fillOpacity: 0.4}).addTo(map).bindPopup('<strong>Gymnasium Borbeck</strong><br><br>Keine Notizen');


		/*function onMapClick(e) {
            console.log('['+String(Math.round(e.latlng.lat*1000000)/1000000)+', '+String(Math.round(e.latlng.lng*1000000)/1000000)+'],');
			//popup.setLatLng(e.latlng).setContent("You clicked the map at " + e.latlng.toString()).openOn(map);
		}

		map.on('click', onMapClick);*/

	</script>
</body>
</html>
